<!-- Recreation of Simulation from "http://questromworld.bu.edu/platformstrategy/simulation/" -->
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" , initial-scale="1" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <link rel="stylesheet" href="style(2).css" integrity="undefined" crossorigin="anonymous"> -->
    <title>Interdependent Demand Curve</title>
  </head>
  <style>
    /* * {
     box-sizing: border-box;
   } */
    body {
      background-color: #add8e6;
    }
    .picker {
      display: block;
    }
    span {
      font-size: 1.1em;
      position: center;
      top: 0px;
      margin-right: 7px;
      display: inline-block;
      color: #707070;
    }
    .bWrap {
      display: inline-block;
    }
    .variable {
      display: inline-block;
      left: -100px;
    }
    .variable2 {
      float: right;
      display: inline-block;
    }
    input[type="number"] {
      position: relative;
      left: 0px;
      display: block;
      width: 4em;
      color: #707070;
    }
    /* #redraw {
   } */
    .profit {
      display: inline;
      position: relative;
      font-weight: bold;
      left: 26%;
      top: 30px;
      background-color: white;
      border: solid 2px #e6e6e6;
      color: #707070;
      padding: 2px;
    }

    .text {
      font-size: 15px;
      padding: 10px;
    }

    .pricing {
      font-size: 18px;
      height: 355px;
      width: 295px;
      display: inline-table;
      background-color: white;
      border: solid 2px #e6e6e6;
      color: #707070;
      padding: 2px;
    }

    .membership {
      font-size: 18px;
      height: 355px;
      width: 200px;
      display: inline-table;
      background-color: white;
      border: solid 2px #e6e6e6;
      color: #707070;
      padding: 2px;
    }

    .advertising {
      font-size: 18px;
      height: 355px;
      width: 200px;
      display: inline-table;
      background-color: white;
      border: solid 2px #e6e6e6;
      color: #707070;
      padding: 2px;
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      font-size: 13px;
      font-family: sans-serif;
      visibility: hidden;
      width: 200px;
      background-color: grey;
      color: #fff;
      text-align: center;
      padding: 5px 0;
      border-radius: 6px;
      position: absolute;
      z-index: 1;
      top: -5px;
      left: 110%;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
    }

    .tooltip .tooltiptext::after {
      content: " ";
      position: absolute;
      top: 50%;
      right: 100%; /* To the right of the tooltip */
      margin-top: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: transparent grey transparent transparent;
    }

    .radioButtons {
      padding: 15px;
      margin-left: 9%;
      display: flex;
    }

    .pageTitle {
      writing-mode: tb-rl;
      transform: rotate(-180deg);
      padding: 15px;
      background-color: white;
      border: solid 2px #e6e6e6;
      display: inline-table;
      text-align: center;
      font-weight: bold;
    }

    .simulation {
      display: inline-table;
      width: 51%;
      padding: 15px;
      background-color: #ffffff;
      border-right: none 0px;
      margin-top: 60px;
    }

    .simulation2 {
      display: inline-table;
      width: 51%;
      padding: 15px;
      background-color: #ffffff;
      margin-top: 60px;
    }

    .simulation3 {
      display: inline-table;
      width: 51%;
      padding: 10px;
      background-color: #ffffff;
      border-left: solid #add8e6 40px;
    }

    .button {
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin-top: 16px;
      font-family: serif;
      transition-duration: 0.4s;
      cursor: pointer;
    }

    .addPoint {
      background-color: white;
      color: gray;
      border: 2px solid #aed6f1;
    }

    .addPoint:hover {
      background-color: #aed6f1;
      color: white;
    }

    .simcontainer {
      background-color: white;
      display: flex;
      margin-left: 10%;
      width: 82%;
    }
  </style>
  <body>
    <div class="profit" id="profit">Total Profit:0.53895</div>
    <div class="simcontainer">
      <div class="pageTitle">
        <span>Platform Dashboard</span>
      </div>
      <div class="simulation">
        <!-- Chart canvas container for the Consumer Price Chart -->
        <div>
          <canvas
            id="consumerChart"
            style="
              display: inline-block;
              height: 100px;
              width: 40%;
              margin-left: 5%;
            "
            class="chartjs-render-monitor"
          ></canvas>
        </div>
      </div>

      <div class="simulation2">
        <!-- Chart canvas container for the Developer Price Chart-->
        <div>
          <canvas
            id="developerChart"
            style="
              display: inline-block;
              height: 100px;
              width: 40%;
              margin-left: 5%;
            "
            class="chartjs-render-monitor"
          ></canvas>
        </div>
      </div>

      <div class="simulation3">
        <!-- Chart canvas container for the Developer Price Chart -->
        <div>
          <canvas
            id="profitChart"
            style="
              display: inline-block;
              height: 150px;
              width: 50%;
              margin-left: 5%;
            "
            class="chartjs-render-monitor"
          ></canvas>
        </div>
        <button
          id="addPoint"
          class="button addPoint"
          value="false"
          onclick="saveChanges()"
        >
          Save Changes
        </button>
      </div>
    </div>

    <div class="radioButtons">
      <div class="pageTitle">
        <span>Adminstrator Controls</span>
      </div>
      <div class="pricing" id="pricing">
        <span>Pricing Policy</span><br />
        <!-- Slider for Consumer Price Input -->
        <div id="slidecontainer">
          <div class="text">
            <div class="variable">
              <div class="tooltip">
                Rider Fees
                <span class="tooltiptext"> Amount riders must spend </span>
                <div class="picker">
                  <div class="bWrap">
                    <!-- Input via slider (0 - 2)-->
                    <input
                      type="range"
                      min="0"
                      max="200"
                      value="100"
                      class="slider"
                      id="myp"
                    />
                    <!-- Input via decimal text box (0 - 2)-->
                    <input
                      type="number"
                      min="0"
                      max="2"
                      value="1"
                      step="any"
                      id="np"
                    /><br />
                  </div>
                </div>
              </div>
            </div>
            <div class="variable">
              <div class="tooltip">
                Driver Fees
                <span class="tooltiptext"> Amount drivers must spend </span>
                <div class="picker">
                  <div class="bWrap">
                    <!-- Input via slider (0 - 2)-->
                    <input
                      type="range"
                      min="0"
                      max="200"
                      value="50"
                      class="slider"
                      id="mypd"
                    />
                    <!-- Input via decimal text box (0 - 2)-->
                    <input
                      type="number"
                      min="0"
                      max="2"
                      value="0.5"
                      step="any"
                      id="npd"
                    /><br />
                  </div>
                </div>
              </div>
            </div>
            <div class="variable">
              <div class="tooltip">
                Surge Pricing
                <span class="tooltiptext">
                  % Markup when drivers are scarce
                </span>
                <div class="picker">
                  <div class="bWrap">
                    <!-- Input via slider (0 - .25)-->
                    <input
                      type="range"
                      min="0"
                      max="25"
                      value="10"
                      class="slider"
                      id="surgePricingSlider"
                    />
                    <!-- Input via decimal text box (0 - .25)-->
                    <input
                      type="number"
                      min="0"
                      max=".25"
                      value="0.1"
                      step="0.01"
                      id="surgePricingText"
                    /><br />
                  </div>
                </div>
              </div>
            </div>
            <div class="variable">
              <div class="tooltip">
                Crime Pricing
                <span class="tooltiptext">
                  % Markup for rides in dangerous area
                </span>
                <div class="picker">
                  <div class="bWrap">
                    <!-- Input via slider (0 - .25)-->
                    <input
                      type="range"
                      min="0"
                      max="25"
                      value="10"
                      class="slider"
                      id="crimePricingSlider"
                    />
                    <!-- Input via decimal text box (0 - .25)-->
                    <input
                      type="number"
                      min="0"
                      max=".25"
                      value="0.1"
                      step="0.01"
                      id="crimePricingText"
                    /><br />
                  </div>
                </div>
              </div>
            </div>
            <div class="variable">
              <div class="tooltip">
                Rider Stars
                <span class="tooltiptext">
                  % Makrup when rider has a low rating
                </span>
                <div class="picker">
                  <div class="bWrap">
                    <!-- Input via slider (0 - 2)-->
                    <input
                      type="range"
                      min="0"
                      max="25"
                      value="10"
                      class="slider"
                      id="riderStarsSlider"
                    />
                    <!-- Input via decimal text box (0 - 2)-->
                    <input
                      type="number"
                      min="0"
                      max=".25"
                      value="0.1"
                      step="0.01"
                      id="riderStarsText"
                    /><br />
                  </div>
                </div>
              </div>
            </div>
            <div class="variable">
              <div class="tooltip">
                Driver Stars
                <span class="tooltiptext">
                  % Discount when driver has a low rating
                </span>
                <div class="picker">
                  <div class="bWrap">
                    <!-- Input via slider (0 - 2)-->
                    <input
                      type="range"
                      min="0"
                      max="25"
                      value="10"
                      class="slider"
                      id="driverStarsSlider"
                    />
                    <!-- Input via decimal text box (0 - 2)-->
                    <input
                      type="number"
                      min="0"
                      max=".25"
                      value="0.1"
                      step="0.01"
                      id="driverStarsText"
                    /><br />
                  </div>
                </div>
              </div>
            </div>
            <div class="variable">
              <div class="tooltip">
                Low Battery
                <span class="tooltiptext">
                  % Markup when rider's cell battery is low
                </span>
                <div class="picker">
                  <div class="bWrap">
                    <!-- Input via slider (0 - 2)-->
                    <input
                      type="range"
                      min="0"
                      max="25"
                      value="10"
                      class="slider"
                      id="lowBatterySlider"
                    />
                    <!-- Input via decimal text box (0 - 2)-->
                    <input
                      type="number"
                      min="0"
                      max=".25"
                      value="0.1"
                      step="0.01"
                      id="lowBatteryText"
                    /><br />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="membership" id="membership">
        <span>Membership Rules</span><br />
        <div class="text">
          <div class="tooltip">
            Ban Riders
            <span class="tooltiptext">
              Remove riders from network if their rating is below this # of
              stars
            </span>
            <input
              type="range"
              min="0"
              max="500"
              value="100"
              class="slider"
              id="riderRatingSlider"
            />
            <input
              type="number"
              min="0"
              max="5"
              value="1"
              step="1"
              id="riderRatingText"
            /><br />
          </div>
          <div class="tooltip">
            Ban Drivers
            <span class="tooltiptext">
              Remove drivers from network if their rating is below this # of
              stars
            </span>
            <input
              type="range"
              min="0"
              max="500"
              value="100"
              class="slider"
              id="driverRatingSlider"
            />
            <input
              type="number"
              min="0"
              max="5"
              value="1"
              step="1"
              id="driverRatingText"
            /><br />
          </div>
        </div>
        <div class="tooltip">
          Rider Redress
          <input
            type="checkbox"
            id="riderRedress"
            name="riderRedress"
            value="riderRedress"
          />
          <label for="riderRedress"></label><br /><br />
          <span class="tooltiptext">
            Riders can pay a fee to remove bad reviews
          </span>
        </div>
        <div class="tooltip">
          Driver Redress
          <input
            type="checkbox"
            id="driverRedress"
            name="driverRedress"
            value="driverRedress"
          />
          <label for="driverRedress"></label><br />
          <span class="tooltiptext">
            Drivers can pay a fee to remove bad reviews
          </span>
        </div>
      </div>
      <div class="advertising" id="advertising">
        <span>Advertising</span><br />
        <div class="text">
          <div class="tooltip">
            Driver-Directed Ads
            <span class="tooltiptext">
              Riders pay a fee to advertise themselves
            </span>
            <input
              type="range"
              min="0"
              max="500"
              value="100"
              class="slider"
              id="driverAdsSlider"
            />
            <input
              type="number"
              min="0"
              max="5"
              value="1"
              step="any"
              id="driverAdsText"
            /><br />
          </div>
          <div class="tooltip">
            Rider-Directed Ads
            <span class="tooltiptext">
              Drivers pay a fee to advertise themselves
            </span>
            <input
              type="range"
              min="0"
              max="500"
              value="100"
              class="slider"
              id="riderAdsSlider"
            />
            <input
              type="number"
              min="0"
              max="5"
              value="1"
              step="integer"
              id="riderAdsText"
            /><br />
          </div>
        </div>
      </div>
    </div>

    <script>
      // Function to determine quantity
      // X -> x-coordinate (Max Market Size - myQ or nQ)
      // Y -> y-coordinate (Max Value - myV or nV)
      // P -> Selected Price (myp or np)
      function plength(x, y, p) {
        m = -y / x;
        x = (p - y) / m;
        return x;
      }

      // Vc -> Maximum Value of the product for consumers (Customers willingingness to pay)
      var Vc = 1;
      // Vd -> Maximum Value of the product for developers (Developers willingingness to pay)
      var Vd = 1;
      // Qc -> Consumer Maximum Market Size (How many consumers are in the market)
      var Qc = 1;
      // Qd -> Developer Maximum Market Size (How many developers are in the market)
      var Qd = 1;
      // pc-> Consumer Price
      var pc = 1;
      // pd-> Developer Price
      var pd = 0.5;
      // ecd -> 0.125 constant value (Effect of purchases in the Consumer market on the Developer market)
      var ecd = 0.125;
      // edc -> 0.875 constant value (Effect of purchases in the Developer market on the Consumer market)
      var edc = 0.875;

      var opc =
        (Vc *
          Vd *
          (Qd * ((ecd * edc - 2) * Qc - edc * Qd) * Vc +
            ecd * Qc * (ecd * Qc + Qd) * Vd)) /
        (edc * edc * Qd * Qd * Vc * Vc +
          2 * (ecd * edc - 2) * Qc * Qd * Vc * Vd +
          ecd * ecd * Qc * Qc * Vd * Vd);
      var opd =
        (Vc *
          Vd *
          (edc * Qd * (Qc + edc * Qd) * Vc +
            Qc * ((ecd * edc - 2) * Qd - ecd * Qc) * Vd)) /
        (edc * edc * Qd * Qd * Vc * Vc +
          2 * (ecd * edc - 2) * Qc * Qd * Vc * Vd +
          ecd * ecd * Qc * Qc * Vd * Vd);

      function updatePricing(pricingType) {
        console.log(pricingType);
        if (pricingType == "static") {
          ecd = 0.125;
          edc = 0.875;
        } else if (pricingType == "dynamic") {
          ecd = 0.5;
          edc = 0.5;
        } else if (pricingType == "personalize") {
          ecd = 0.875;
          edc = 0.125;
        }

        calcUpdate(Qc, Qd, Vc, Vd, 0.2, 0.2, ecd, edc);
      }

      // Consumer Price from slider input
      var spc = document.getElementById("myp");
      // Developer Price from slider input
      var spd = document.getElementById("mypd");
      // Consumer Price from text box input
      var npc = document.getElementById("np");
      // Developer Price from text box input
      var npd = document.getElementById("npd");
      // Total profit made from our system
      var totalProfit = document.getElementById("profit");
      // Chart from canvas node consumerChart
      var ctx1 = document.getElementById("consumerChart").getContext("2d");
      // Chart from canvas node developerChart
      var ctx2 = document.getElementById("developerChart").getContext("2d");
      // Chart from canvas node profitChart
      var ctx3 = document.getElementById("profitChart").getContext("2d");

      var chart1 = new Chart(ctx1, {
        // The type of chart we want to create
        type: "scatter",

        // The data for our dataset
        data: {
          datasets: [
            {
              // Consumer Surplus
              // From the Max Value to Max Market Size
              label: "Consumer Surplus",
              fill: 1,
              backgroundColor: "rgba(255, 192, 99, 0.5)", // orange
              lineTension: 0,
              pointHoverRadius: 3,
              data: [
                {
                  x: 0,
                  y: 1,
                },
                {
                  x: 1,
                  y: 0,
                },
              ],
            },
            {
              // Profit
              // Selected Price * Calculated Quantity from plength(x, y, p)
              label: "Rider Profit = Riders * Fees = (" + ")",
              fill: true,
              backgroundColor: "rgba(88, 214, 141, 0.5)", // light green
              pointHoverRadius: 3,
              data: [
                {
                  x: 0,
                  y: 1,
                },
                {
                  x: 0,
                  y: 1,
                },
              ],
            },
            {
              // Dead Weight Loss
              // Starts at the end of the quantity and goes to the Max Market Size (Q)
              label: "DWL",
              pointHoverRadius: 3,
              fill: true,
              // red
              backgroundColor: "rgba(255, 99, 132, 0.5)",
              lineTension: 0,
              data: [
                {
                  x: 0,
                  y: 1,
                },
                {
                  x: 1,
                  y: 0,
                },
              ],
            },
          ],
        },

        // Configuration options go here
        options: {
          responsive: true,
          scales: {
            xAxes: [
              {
                type: "linear",
                ticks: {
                  fontSize: 11,
                  suggestedMax: 2.3,
                  min: 0,
                },
                title: {
                  display: true,
                  text: "# of Potential Riders",
                },
              },
            ],
            yAxes: [
              {
                type: "linear",
                ticks: {
                  fontSize: 11,
                  suggestedMax: 2.3,
                },
                title: {
                  display: true,
                  text: "Rider Base Fees",
                },
              },
            ],
          },
        },
      });

      var chart2 = new Chart(ctx2, {
        // The type of chart we want to create
        type: "scatter",

        // The data for our dataset
        data: {
          datasets: [
            {
              // Consumer Surplus
              // From the Max Value to Max Market Size
              label: "Consumer Surplus",
              fill: 1,
              pointHoverRadius: 3,
              // orange
              backgroundColor: "rgba(255, 192, 99, 0.5)",
              lineTension: 0,
              data: [
                {
                  x: 0,
                  y: 1,
                },
                {
                  x: 1,
                  y: 0,
                },
              ],
            },
            {
              // Profit
              // Selected Price * Calculated Quantity from plength(x, y, p)
              label: "Profit(" + ")",
              backgroundColor: "rgba(84, 153, 199, 0.5)", // light blue
              fill: true,
              data: [
                {
                  x: 0,
                  y: 1,
                },
                {
                  x: 0,
                  y: 1,
                },
              ],
            },
            {
              // Dead Weight Loss
              // Starts at the end of the quantity and goes to the Max Market Size (Q)
              label: "DWL",
              pointHoverRadius: 3,
              fill: true,
              // red
              backgroundColor: "rgba(255, 99, 132, 0.5)",
              lineTension: 0,
              data: [
                {
                  x: 0,
                  y: 1,
                },
                {
                  x: 1,
                  y: 0,
                },
              ],
            },
          ],
        },

        // Configuration options go here
        options: {
          responsive: true,
          scales: {
            xAxes: [
              {
                type: "linear",
                ticks: {
                  fontSize: 11,
                  suggestedMax: 2.3,
                  min: 0,
                },
              },
            ],
            yAxes: [
              {
                type: "linear",
                ticks: {
                  fontSize: 11,
                  suggestedMax: 2.3,
                  //stepSize: 0.25
                },
              },
            ],
          },
        },
      });

      var chart3 = new Chart(ctx3, {
        // The type of chart being cretated
        type: "bar",
        // The data for our dataset
        data: {
          datasets: [
            {
              label: "Rider Profit",
              //barThickness: 40,
              borderColor: "rgba(175, 122, 197, 0.5)",
              backgroundColor: "rgba(175, 122, 197, 0.5)", // purple
              data: [],
            },
            {
              label: "Driver Profit",
              //barThickness: 40,
              borderColor: "rgba(84, 153, 199, 0.5)",
              backgroundColor: "rgba(84, 153, 199, 0.5)", // light blue
              data: [],
            },
          ],
        },
        // Configuration options go here
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: "Changes in Total Profit",
            },
          },
          scales: {
            x: {
              stacked: true,
            },
            y: {
              stacked: true,
            },
          },
        },
      });

      // Update the values of the chart
      // Initial consumer price is set to 0.2 (pc = 0.2)
      // Initial developer price is set to 0.2 (pd = 0.2)
      calcUpdate(Qc, Qd, Vc, Vd, 0.2, 0.2, ecd, edc);
      addData(chart3, "", 0.33684, 0.20211);

      // Function to update  the values of the chart
      // Qc -> Consumer Maximum Market Size (How many consumers are in the market)
      // Qd -> Developer Maximum Market Size (How many developers are in the market)
      // Vc -> Maximum Value of the product for consumers (Customers willingingness to pay)
      // Vd -> Maximum Value of the product for developers (Developers willingingness to pay)
      // pc-> Consumer Price
      // pd-> Developer Price
      // ecd -> 0.125 constant value (Effect of purchases in the Consumer market on the Developer market)
      // edc -> 0.875 constant value (Effect of purchases in the Developer market on the Consumer market)
      // left -> boolean value reprsents which price has been adjusted (true -> consumer price was adjusted/false -> dev price was adjusted)
      function calcUpdate(Qc, Qd, Vc, Vd, pc, pd, ecd, edc, left) {
        // Keep within Range 0-2
        // Consumer Price
        if (pc > 2) pc = 2;
        if (pc < 0) pc = 0;

        // Keep within Range 0-2
        // Developer Price
        if (pd > 2) pd = 2;
        if (pd < 0) pd = 0;

        // Update values from the consumer price input (either sliders or text box)
        spc.value = pc * 100;
        npc.value = pc;

        // Update values from the developer price input (either sliders or text box)
        spd.value = pd * 100;
        npd.value = pd;

        // Profit Size Length for consumers represents Quantity
        // Similar to the plenght() function in the single sided market simulation
        // qc represents the x-value of the profit for consumers (the quantity)
        let qc =
          (edc * Qd * Vc * (pd - Vd) + Qc * (pc - Vc) * Vd) /
          ((ecd * edc - 1) * Vc * Vd);

        // Profit Size Length for developers represents Quantity
        // Similar to the plenght() function in the single sided market simulation
        // qd represents the x-value of the profit for developers (the quantity)
        let qd =
          (pd * Qd * Vc + (ecd * Qc * (pc - Vc) - Qd * Vc) * Vd) /
          ((ecd * edc - 1) * Vc * Vd);

        // If the consumer profit is ever smaller than 0
        if (qc < 0) {
          qc = 0;
          // Don't let consumer price go over 1.875
          if (pc > 1 + edc) {
            pc = 1 + edc;
          }

          //pd = (1.125 - pc)/0.125; <-- not my comment, not sure what it represents

          // If left is true, then consumer price is equal to 1.875 - (developer price * 1.875)
          // if not, then the developer price is equal to (2.875 - consumer price)/ 1.875
          // When consumer price is adjusted, the developer price changes
          // When developer price is adjusted, the consumer price changes
          if (left) {
            pc = 1 + edc - pd * edc;
          } else {
            pd = (edc + 1 - pc) / edc;
          }

          // Update the profit lengths for both consumers (qc) and developers (qd) with updated values
          qc =
            (edc * Qd * Vc * (pd - Vd) + Qc * (pc - Vc) * Vd) /
            ((ecd * edc - 1) * Vc * Vd);
          qd =
            (pd * Qd * Vc + (ecd * Qc * (pc - Vc) - Qd * Vc) * Vd) /
            ((ecd * edc - 1) * Vc * Vd);

          spd.value = pd * 100;
          npd.value = pd;
          spc.value = pc * 100;
          npc.value = pc;
        }

        // If the developer profit is ever smaller than 0
        if (qd < 0) {
          qd = 0;
          if (pd > ecd + 1) {
            pd = ecd + 1;
          }
          if (left) {
            pc = (ecd + 1 - pd) / ecd;
          } else {
            pd = ecd + 1 - pc * ecd;
          }

          // Profit Size Length for consumers
          // Similar to the plenght() function in the single sided market simulation
          // qc represents the x-value of the profit for consumers
          qc =
            (edc * Qd * Vc * (pd - Vd) + Qc * (pc - Vc) * Vd) /
            ((ecd * edc - 1) * Vc * Vd);

          // Profit Size Length for developers
          // Similar to the plenght() function in the single sided market simulation
          // qc represents the x-value of the profit for developers
          qd =
            (pd * Qd * Vc + (ecd * Qc * (pc - Vc) - Qd * Vc) * Vd) /
            ((ecd * edc - 1) * Vc * Vd);

          spd.value = pd * 100;
          npd.value = pd;
          spc.value = pc * 100;
          npc.value = pc;
        }

        // The y value of the consumer chart (The Maximum Value)
        let yc =
          ((Qc +
            edc *
              ((pd * Qd * Vc + (ecd * Qc * (pc - Vc) - Qd * Vc) * Vd) /
                ((ecd * edc - 1) * Vc * Vd))) *
            Vc) /
          Qc;

        // The x value of the consumer chart (The Maximum Market Size)
        let xc =
          Qc +
          edc *
            ((pd * Qd * Vc + (ecd * Qc * (pc - Vc) - Qd * Vc) * Vd) /
              ((ecd * edc - 1) * Vc * Vd));

        // The y value of the developer chart (The Maximum Value)
        let yd =
          ((Qd +
            ecd *
              ((pc * Qc * Vd + (edc * Qd * (pd - Vd) - Qc * Vd) * Vc) /
                ((edc * ecd - 1) * Vd * Vc))) *
            Vd) /
          Qd;

        // The x value of the developer chart (The Maximum Market Size)
        let xd =
          Qd +
          ecd *
            ((pc * Qc * Vd + (edc * Qd * (pd - Vd) - Qc * Vd) * Vc) /
              ((edc * ecd - 1) * Vd * Vc));

        // Consumer Price cannot exceed  Consumer Maximum Market Size
        if (pc > yc) {
          pc = yc;
        }

        // Developer Price cannot exceed Consumer Maximum Market Size
        if (pd > yd) {
          pd = yd;
        }

        var opc =
          (Vc *
            Vd *
            (Qd * ((ecd * edc - 2) * Qc - edc * Qd) * Vc +
              ecd * Qc * (ecd * Qc + Qd) * Vd)) /
          (edc * edc * Qd * Qd * Vc * Vc +
            2 * (ecd * edc - 2) * Qc * Qd * Vc * Vd +
            ecd * ecd * Qc * Qc * Vd * Vd);
        var opd =
          (Vc *
            Vd *
            (edc * Qd * (Qc + edc * Qd) * Vc +
              Qc * ((ecd * edc - 2) * Qd - ecd * Qc) * Vd)) /
          (edc * edc * Qd * Qd * Vc * Vc +
            2 * (ecd * edc - 2) * Qc * Qd * Vc * Vd +
            ecd * ecd * Qc * Qc * Vd * Vd);

        // Total Profit is maximized (turns green) when |0.875 - consumer price| < 0.001 AND when |0.125 - developer price| < 0.001
        var totalProfit2 = pd * qd + pc * qc;

        if (Math.abs(opc - pc) < 0.001 && Math.abs(opd - pd) < 0.001) {
          chart1.data.datasets[1].backgroundColor = "rgba(132, 255, 99, 0.5)";
          chart1.data.datasets[1].label =
            "Rider Profit = Riders * Fees = (" +
            (pc * qc).toFixed(5) +
            ") ~ Optimal";

          chart2.data.datasets[1].backgroundColor = "rgba(132, 255, 99, 0.5)";
          chart2.data.datasets[1].label =
            "Driver Profit = Drivers * Fees = (" +
            (pd * qd).toFixed(5) +
            ") ~ Optimal";
        } else {
          chart1.data.datasets[1].backgroundColor = "rgba(175, 122, 197, 0.5)"; // purple
          chart1.data.datasets[1].label =
            "Rider Profit = Riders * Fees = (" + (pc * qc).toFixed(5) + ")";

          chart2.data.datasets[1].backgroundColor = "rgba(84, 153, 199, 0.5)"; // light blue
          chart2.data.datasets[1].label =
            "Driver Profit = Drivers * Fees = (" + (pd * qd).toFixed(5) + ")";
        }

        // Calculates the total profit from both consumers and developers
        // Total Profit = Price * Quantity

        totalProfit.innerHTML =
          "Total Profit = Rider Profit + Driver Profit - Expenses = " +
          (pd * qd + pc * qc).toFixed(5);

        chart1.data.datasets[0].data[0].y = yc;
        chart1.data.datasets[0].data[1].x = qc;
        chart1.data.datasets[0].data[1].y = pc;
        chart1.data.datasets[1].data[0].y = pc;
        chart1.data.datasets[1].data[1].y = pc;
        chart1.data.datasets[1].data[1].x = qc;
        chart1.data.datasets[2].data[0].x = qc;
        chart1.data.datasets[2].data[0].y = pc;
        chart1.data.datasets[2].data[1].x = xc;
        chart1.data.datasets[2].data[1].y = 0;

        chart2.data.datasets[0].data[0].y = yd;
        chart2.data.datasets[0].data[1].x = qd;
        chart2.data.datasets[0].data[1].y = pd;
        chart2.data.datasets[1].data[0].y = pd;
        chart2.data.datasets[1].data[1].y = pd;
        chart2.data.datasets[1].data[1].x = qd;
        chart2.data.datasets[2].data[0].x = qd;
        chart2.data.datasets[2].data[0].y = pd;
        chart2.data.datasets[2].data[1].x = xd;
        chart2.data.datasets[2].data[1].y = 0;

        const copyOfCProfit = pc * qc;
        const copyOfDProfit = pd * qd;

        var change = document.getElementById("addPoint");

        if (change.value == "true") {
          addData(chart3, "", copyOfCProfit, copyOfDProfit);
          change.value = "false";
        }

        chart1.update();
        chart2.update();
        chart3.update();
      }

      function addData(chart, label, riderData, driverData) {
        chart.data.labels.push(label);
        // Adding new rider Profit
        chart.data.datasets[0].data.push(riderData);
        // Adding new driver Profit
        chart.data.datasets[1].data.push(driverData);
        chart.update();
      }

      function saveChanges() {
        var change = document.getElementById("addPoint");
        change.value = "true";
        console.log(change.value);
        //changes names later
        // const Qc = document.getElementById();
        // const Qd = document.getElementById();
        // const Vc = document.getElementById();
        // const Vd = document.getElementById();
        const pc = document.getElementById("np");
        const pd = document.getElementById("npd");
        // const ecd = document.getElementById();
        // const edc = document.getElementById();
        // const left = document.getElementById();

        calcUpdate(
          Qc,
          Qd,
          Vc,
          Vd,
          parseFloat(pc.value),
          parseFloat(pd.value),
          ecd,
          edc,
          true
        );
      }

      spc.oninput = function () {
        calcUpdate(Qc, Qd, Vc, Vd, this.value / 100, npd.value, ecd, edc, true);
      };

      npc.oninput = function () {
        calcUpdate(Qc, Qd, Vc, Vd, this.value, npd.value, ecd, edc, true);
      };

      spd.oninput = function () {
        calcUpdate(
          Qc,
          Qd,
          Vc,
          Vd,
          npc.value,
          this.value / 100,
          ecd,
          edc,
          false
        );
      };

      npd.oninput = function () {
        calcUpdate(Qc, Qd, Vc, Vd, npc.value, this.value, ecd, edc, false);
      };
      // surgePricingSlider.oninput = function() {
      //   calcUpdate(Qc, Qd, Vc, Vd, this.value/100, npd.value, ecd, edc, true);
      // }
    </script>
  </body>
</html>
